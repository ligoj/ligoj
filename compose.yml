services:
  db:
    container_name: ligoj-db
    restart: always
    networks:
      - ligoj-network
  api:
    container_name: ligoj-api
    image: ${LIGOJ_REGISTRY:-}ligoj/ligoj-api:${LIGOJ_VERSION:-3.3.0}
    build:
      context: app-api
      platforms:
        - ${LIGOJ_PLATFORM_1:-linux/amd64}
        - ${LIGOJ_PLATFORM_2:-linux/arm64}
    restart: always
    environment:
      JAVA_OPTIONS: ${LIGOJ_API_JAVA_OPTIONS:--Duser.timezone=UTC}
      CUSTOM_OPTS: ${LIGOJ_API_CUSTOM_OPTS:--Djdbc.host=ligoj-db}
      CRYPTO: ${LIGOJ_API_CRYPTO:--Dapp.crypto.password=public}
    links:
      - db:ligoj-db
    depends_on: 
      - db
    volumes:
      - ${LIGOJ_HOME:-/home/ligoj}:/home/ligoj
    networks:
      - ligoj-network
  ui:
    container_name: ligoj-ui
    image: ${LIGOJ_REGISTRY:-}ligoj/ligoj-ui:${LIGOJ_VERSION:-3.3.0}
    build:
      context: app-ui
      platforms:
        - ${LIGOJ_PLATFORM_1:-linux/amd64}
        - ${LIGOJ_PLATFORM_2:-linux/arm64}
    restart: always
    environment:
      SERVER_PORT: ${LIGOJ_WEB_PORT:-8080}
      CONTEXT_URL: ${LIGOJ_WEB_CONTEXT_URL:-/ligoj}
      JAVA_OPTIONS: ${LIGOJ_WEB_JAVA_OPTIONS:--Duser.timezone=UTC -Dsecurity=Rest}"
      CUSTOM_OPTS: ${LIGOJ_WEB_CUSTOM_OPTS:-}
      CRYPTO: ${LIGOJ_WEB_CRYPTO:--Dapp.crypto.password=public}
    links:
      - api:ligoj-api
    ports: 
      - "${LIGOJ_PORT:-8080}:${LIGOJ_WEB_PORT:-8080}"
    volumes:
      - ${LIGOJ_HOME:-/home/ligoj}:/home/ligoj
    networks:
      - ligoj-network
networks:
  ligoj-network:
